<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MMU Drifting Bottle</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <header>
        <a href="{{url_for('main.homepage')}}" style="position: absolute; left: 80px; transform: translateX(-50%); top: -10px;">
            <img src="{{url_for('static', filename='ebeemmu.png')}}" alt="logo" width="150" height="105" style="margin-left: 10px;">
        </a>
        <div style="color: white; position: absolute; left: 130px; top: 70px; font-size: 18px;">Back</div>
        <div>Drifting Bottle</div>
        <nav>
            <ul>
                <li><a href="{{ url_for('forum.homepage') }}">Forum</a></li>
                <li><a href="{{ url_for('MatchChat.home') }}">Match Chat</a></li>
                <li><a href="{{ url_for('bottle.DriftingBottle') }}">Drifting Bottle</a></li>
                <li><a href="{{ url_for('profile.myProfile') }}">Profile</a></li>
                <li>
                {% if 'user_id' in session %}
                <span style="color: rgb(255, 255, 255); font-weight: bold;">Welcome</span>
                {% else %}
                <a href="{{ url_for('login.home') }}" class="homepage-login">Login</a>
                {% endif %}
                </li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="section">
            <h2>Throw a BottleÔºÅ</h2>
            <form id="throwForm" action="{{ url_for('bottle.throw') }}" method="post" enctype="multipart/form-data">
                <textarea name="content" rows="4" placeholder="Write your message..." required></textarea><br>

                <label for="file">Upload a file here (image/audio/video)</label>
                <input type="file" name="file"><br><br>

                <label for="campus">Select your campus:</label>
                <select name="campus" required>
                    <option value="all">Mix campuses</option>
                    <option value="cyberjaya">Cyberjaya</option>
                    <option value="melaka">Melaka</option>
                </select><br><br>

                <button type="submit" id="submit">Throw it to the sea</button>
            </form>

            <p class="info">There are {{ unpicked_count }} bottles floating in the sea üåä</p>
        </div>

        <div class="section">
            <h2>Pick a Bottle!</h2>
            <form action="{{ url_for('bottle.pick') }}" method="get">
                <label for="campus">Select pick campus:</label>
                <select name="campus" id="campus">
                    <option value="all">Mix campuses</option>
                    <option value="cyberjaya">Cyberjaya
                    <option value="melaka">Melaka</option>
                </select>
                <br><br>
                <button type="submit" id="throwBtn">Throw it to the sea</button>
            </form>

            <p class="info">
                {% if unpicked_count > 0 %}
                    There are {{ unpicked_count }} bottles floating in the sea
                {% else %}
                    No bottles are floating in the sea right now
                {% endif %}
            </p>
        </div>

        <div id="videoPopup" style="display:none;"> 
            <div style="position:relative; background:#fff; padding:2px; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.5);">
                <span id="closeBtn" class="close-btn">√ó</span>
                <video id="throwVideo" style="width: 90vw; height: auto; max-height: 90vh; border-radius: 10px;">
                    <source src="{{ url_for('static', filename='throw.mp4') }}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
        </div>

        <script>
        document.getElementById("throwForm").addEventListener("submit", function(event) {
            event.preventDefault(); 

            var form = this;
            var popup = document.getElementById("videoPopup");
            var video = document.getElementById("throwVideo");

            popup.style.display = "flex";
            video.currentTime = 0;
            video.play();

            video.onended = function() {
                popup.style.display = "none";
                console.log("video ended, submitting form");
                HTMLFormElement.prototype.submit.call(form);
            };

            document.getElementById("closeBtn").onclick = function() {
                popup.style.display = "none";
                video.pause();
                console.log("closed, submitting form");
                HTMLFormElement.prototype.submit.call(form);
            };
        });
        </script>
    </main>
</body>
</html>
