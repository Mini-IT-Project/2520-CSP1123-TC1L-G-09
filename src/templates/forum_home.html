<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <title>MMU SOUL Â· FORUM</title>
</head>
<body>
    <header>
        MMU SOUL Â· FORUM
        <div class="search-section">
            <form class="search-container" action="{{ url_for('forum.homepage') }}" method="get">
                <input
                    name="q"
                    value="{{ q|default('') }}"
                    placeholder="Search posts or #tags..."
                />
                <button type="submit">Search</button>
            </form>
        </div>
    </header>

    <main>
        <section id="feed">
            {% for p in posts or [] %}
            <article class="post-card">
                <div class="post-meta">
                    <img src="{{url_for('static',filename='avatar' ~ (p.author.profile.avatar_type if p.author and p.author.profile else 0)~'.png')}}" class="avatar" alt="avatar" 
                    style="width:40px; height:40px; border-radius:50%; object-fit:cover;">
                    <div>
                        <h3><a href="{{url_for('forum.post_detail',post_id=p.id)}}">{{p.title}}</a></h3>
                        <span class="timestamp">{{p.created_at.strftime('%Y-%m-%d %H:%M')}}</span>
                    </div>
                </div>

                <div class="post-content">
                    <p class="post-excerpt">{{ p.content[:100] }}{% if p.content|length > 100 %}...{% endif %}</p>
                    {% if p.media_url %}
                    {% set _m=p.media_url.lower() %}
                    {% if _m.endswith('.png') or _m.endswith('.jpg') or _m.endswith('.jpeg') or _m.endswith('.gif') %}
                    <img class="media" src="{{p.media_url}}" alt="image" />
                    {% else %}
                    <video class="media" controls>
                        <source src="{{p.media_url}}" />
                    </video>
                    {% endif %}
                    {% endif %}
                </div>

                <div class="tags">
                    {% for t in p.tags or [] %}
                    <a class="tag" href="{{url_for('forum.homepage',tag=t.name)}}">#{{t.name}}</a>
                    {% endfor %}
                </div>

                <div class="post-actions">
                    <button type="button" class="icon-btn like-btn" data-id="{{ p.id }}">ğŸ‘ğŸ»<span class="like-count">{{ p.like_count()}}</span></button>
                    <a class="icon-btn comment-btn" href="{{ url_for('forum.post_detail', post_id=p.id) }}#comments">ğŸ’¬<span class="comment-count">{{ p.comment_count()}}</span></a>
                    <button type="button" class="icon-btn share-btn" data-url="{{ url_for('forum.post_detail', post_id=p.id, _external=True) }}">ğŸ”—</button>
                </div>
            </article>
            {% else %}
            <p class="muted">No post yet. Be the first to share something! ğŸ‰</p>
            {% endfor %}
        </section>
    </main>

    <a class="floating-btn" href="{{ url_for('forum.create_post') }}">
        <span>+</span>
        <span class="tooltip">Create new post</span>
    </a>
</body>
</html>
