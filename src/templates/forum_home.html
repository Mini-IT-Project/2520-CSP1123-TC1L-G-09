<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <title>MMU SOUL · FORUM</title>
</head>
<body>
    <header>
        <a href="{{url_for('main.homepage')}}" style="position: absolute; left: 80px; transform: translateX(-50%); top: -10px;">
            <img src="{{url_for('static', filename='mmuebee.png')}}" alt="logo" width="150" height="105" style="margin-left: 10px;">
        </a>
        MMU SOUL · FORUM
        <div class="search-section">
            <form class="search-container" action="{{ url_for('forum.homepage') }}" method="get">
                <input
                    name="q"
                    value="{{ q|default('') }}"
                    placeholder="Search posts or #tags..."
                />
                <button type="submit">Search</button>
            </form>
        </div>
        <nav>
            <ul>
                <li><a href="{{ url_for('forum.homepage') }}">Forum</a></li>
                <li><a href="{{ url_for('main.match_chat') }}">Match Chat</a></li>
                <li><a href="{{ url_for('bottle.DriftingBottle') }}">Drifting Bottle</a></li>
                <li><a href="{{ url_for('profile.myProfile') }}">Profile</a></li>
                <li>
                {% if 'user_id' in session %}
                <span style="color: rgb(255, 255, 255); font-weight: bold;">Welcome</span>
                {% else %}
                <a href="{{ url_for('login.home') }}" class="homepage-login">Login</a>
                {% endif %}
                </li>
            </ul>
        </nav>
    </header>

    <main>
        {% if posts %}
        <!-- 卡片布局（多列） -->
        <section class="card-feed active">
            {% for p in posts %}
            <div class="post-card">
                <div class="post-header">
                    <div class="avatar"></div>
                    <span class="post-time">{{ p.created_at.strftime('%Y-%m-%d %H:%M') if p.created_at else '' }}</span>
                </div>
                <h3 class="post-title">
                    <a href="{{ url_for('forum.post_detail', post_id=p.id) }}">{{ p.title }}</a>
                </h3>
                <p class="post-excerpt">{{ p.content[:100] }}{% if p.content|length > 100 %}...{% endif %}</p>
                <div class="post-actions">
                    <button class="btn blue-btn comment-btn">💬 {{ p.comment_count }}</button>
                    <button class="btn blue-btn like-btn">👍 {{ p.like_count }}</button>
                    <button class="btn blue-btn share-btn">🔗</button>
                </div>
                <a href="{{ url_for('forum.post_detail', post_id=p.id) }}" class="details-btn">View Details</a>
            </div>
            {% endfor %}
        </section>

        <!-- 时间轴布局（单列） -->
        <section class="timeline-feed">
            {% for p in posts %}
            <div class="timeline-item">
                <div class="timeline-date">{{ p.created_at.strftime('%Y-%m-%d') if p.created_at else '' }}</div>
                <div class="timeline-content">
                    <div class="post-header">
                        <div class="avatar"></div>
                        <span class="post-time">{{ p.created_at.strftime('%H:%M') if p.created_at else '' }}</span>
                    </div>
                    <h3 class="post-title">
                        <a href="{{ url_for('forum.post_detail', post_id=p.id) }}">{{ p.title }}</a>
                    </h3>
                    <p class="post-excerpt">{{ p.content[:150] }}{% if p.content|length > 150 %}...{% endif %}</p>
                    <div class="post-actions">
                        <button class="btn blue-btn comment-btn">💬 {{ p.comment_count }}</button>
                        <button class="btn blue-btn like-btn">👍 {{ p.like_count }}</button>
                        <button class="btn blue-btn share-btn">🔗</button>
                    </div>
                    <a href="{{ url_for('forum.post_detail', post_id=p.id) }}" class="details-btn">View Details</a>
                </div>
            </div>
            {% endfor %}
        </section>

        {% else %}
        <p class="muted" style="padding: 20px;">No post yet. Be the first to share something! 🎉</p>
        {% endif %}
    </main>

    <a class="floating-btn" href="{{ url_for('forum.create_post') }}">
        <span>+</span>
        <span class="tooltip">Create new post</span>
    </a>
</body>
</html>
